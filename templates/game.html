<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>1A2B éŠæˆ²</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<script>
    function fetchHistory() {
        fetch(`/history/{{ game_id }}`)
            .then(response => response.json())
            .then(data => {
                const table = document.getElementById("history-table");
                // å…ˆæ¸…é™¤èˆŠè³‡æ–™ï¼ˆé™¤äº†è¡¨é ­ï¼‰
                table.innerHTML = `
                    <tr>
                        <th>æš±ç¨±</th>
                        <th>çŒœæ¸¬</th>
                        <th>çµæœ</th>
                    </tr>
                `;
                // åŠ å…¥æ–°è³‡æ–™
                data.guesses.forEach(g => {
                    const row = table.insertRow();
                    row.innerHTML = `<td>${g.name}</td><td>${g.guess}</td><td>${g.result}</td>`;
                });
            });
    }

    // æ¯ 2 ç§’æ›´æ–°ä¸€æ¬¡
    setInterval(fetchHistory, 2000);
</script>
<body>
    <div class="container">
        <h1>ğŸ¯ çŒœ {{ length }} ä½æ•¸å­—ï¼ˆå¯é‡è¤‡ï¼‰</h1>
        <p><strong>éŠæˆ²ä»£ç¢¼ï¼š</strong> {{ game_id }}</p>
        <p><strong>å›åˆï¼š</strong> ç¬¬ {{ round }} å›åˆ</p>

        {% if wins %}
            <p><strong>ç­”å°çµ±è¨ˆï¼š</strong>
                {% for name, count in wins.items() %}
                    {{ name }}ï¼š{{ count }} æ¬¡
                {% endfor %}
            </p>
        {% endif %}


        <form method="post">
            <label>çŒœæ¸¬ï¼š</label>
            <input type="text" name="guess" maxlength="{{ length }}" placeholder="è¼¸å…¥ {{ length }} ä½æ•¸">
            <button type="submit" class="btn">é€å‡º</button>
        </form>

        {% if message %}
            <p class="result">çµæœï¼š{{ message }}</p>
        {% endif %}

        {% if message and 'æ­å–œ' in message and session.nickname == host %}
            <form method="post" action="/new_game">
                <input type="hidden" name="game_id" value="{{ game_id }}">
                <input type="hidden" name="nickname" value="{{ session.nickname }}">
                <input type="hidden" name="difficulty" value="{{ length }}">
                <button type="submit" class="btn success">å†ç©ä¸€å±€</button>
            </form>
        {% endif %}


        <h2>ğŸ“œ æ­·å²ç´€éŒ„</h2>
		<table id="history-table">
                <tr>
                    <th>æš±ç¨±</th>
                    <th>çŒœæ¸¬</th>
                    <th>çµæœ</th>
                </tr>
                {% for g in guesses %}
                <tr>
                    <td>{{ g.name }}</td>
                    <td>{{ g.guess }}</td>
                    <td>{{ g.result }}</td>
                </tr>
                {% endfor %}
        </table>

        <p><a href="/">å›é¦–é </a></p>
    </div>
</body>
</html>
